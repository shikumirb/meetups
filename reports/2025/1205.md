# [\#19](https://shikumirb.connpass.com/event/376125/)

## やったこと

udzura さんの資料をみんなでワイワイ言いながら復習しました！

[Rubyの中身の予備知識\_RubyKaigiの前に知り鯛！\_公開用 \- Google スライド](https://docs.google.com/presentation/d/1oFvP4W3Ox8uiGXsWa3ibyDga1cpLguVZhwCjpD46hFU/mobilepresent?slide=id.g3389fccf211_0_67)

その後、`ruby` コマンドの `--dump` オプションを利用して LR パーサのデバッグ情報を出力してワイワイしました！

### Ruby のバージョン

以下では、Ruby のバージョン 3.4.5 を利用している。

```sh
❯ ruby -v
ruby 3.4.5 (2025-07-16 revision 20cda200d3) +PRISM [x86_64-darwin22]
```

### `--dump` オプション

`ruby` コマンドの `--dump` オプションを利用すれば、LR パーサの中間生成物やデバッグ情報を出力できる。

```sh
# パーサの状態遷移を出力
$ ruby --parser=parse.y --dump=yydebug -e "1 + 2 * 3"

# AST を出力
$ ruby --parser=parse.y --dump=parsetree -e "1 + 2 * 3"

# ISeq を出力
$ ruby --parser=parse.y --dump=insns -e "1 + 2 * 3"
```

レキサーが生成するトークン列を見るための専用のオプションはなさそう。

`--dump=yydebug` の出力を加工すれば、レキサーが生成するトークン列も出力できる。

```sh
# トークン列を出力
$ ruby --parser=parse.y --dump=yydebug -e "1 + 2 * 3" | grep 'Next token' | uniq | sed -E 's/.*is token (.*) \(.*/\1/'
"integer literal"
'+'
"integer literal"
'*'
"integer literal"
'\n'
```

ちなみに、`--dump` オプションで指定できる値はヘルプでも確認できる。

```sh
❯ ruby --help | grep -A 6 "Dump List"
Dump List:
  insns           Instruction sequences.
  yydebug         yydebug of yacc parser generator.
  parsetree       Abstract syntax tree (AST).
  -optimize       Disable optimization (affects insns).
  +error-tolerant Error-tolerant parsing (affects yydebug, parsetree).
  +comment        Add comments to AST (affects parsetree with --parser=parse.y).
```
